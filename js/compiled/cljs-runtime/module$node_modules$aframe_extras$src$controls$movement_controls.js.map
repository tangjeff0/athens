{
"version":3,
"file":"module$node_modules$aframe_extras$src$controls$movement_controls.js",
"lineCount":7,
"mappings":"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",
"sources":["node_modules/aframe-extras/src/controls/movement-controls.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$aframe_extras$src$controls$movement_controls\"] = function(global,require,module,exports) {\n/**\n * Movement Controls\n *\n * @author Don McCurdy <dm@donmccurdy.com>\n */\n\nconst COMPONENT_SUFFIX = '-controls',\n    MAX_DELTA = 0.2, // ms\n    EPS = 10e-6;\n\nmodule.exports = AFRAME.registerComponent('movement-controls', {\n\n  /*******************************************************************\n   * Schema\n   */\n\n  dependencies: ['rotation'],\n\n  schema: {\n    enabled:            { default: true },\n    controls:           { default: ['gamepad', 'trackpad', 'keyboard', 'touch'] },\n    speed:              { default: 0.3, min: 0 },\n    fly:                { default: false },\n    constrainToNavMesh: { default: false },\n    camera:             { default: '[movement-controls] [camera]', type: 'selector' }\n  },\n\n  /*******************************************************************\n   * Lifecycle\n   */\n\n  init: function () {\n    const el = this.el;\n\n    this.velocityCtrl = null;\n\n    this.velocity = new THREE.Vector3();\n    this.heading = new THREE.Quaternion();\n\n    // Navigation\n    this.navGroup = null;\n    this.navNode = null;\n\n    if (el.sceneEl.hasLoaded) {\n      this.injectControls();\n    } else {\n      el.sceneEl.addEventListener('loaded', this.injectControls.bind(this));\n    }\n  },\n\n  update: function (prevData) {\n    const el = this.el;\n    const data = this.data;\n    const nav = el.sceneEl.systems.nav;\n    if (el.sceneEl.hasLoaded) {\n      this.injectControls();\n    }\n    if (nav && data.constrainToNavMesh !== prevData.constrainToNavMesh) {\n      data.constrainToNavMesh\n        ? nav.addAgent(this)\n        : nav.removeAgent(this);\n    }\n  },\n\n  injectControls: function () {\n    const data = this.data;\n    var name;\n\n    for (let i = 0; i < data.controls.length; i++) {\n      name = data.controls[i] + COMPONENT_SUFFIX;\n      if (!this.el.components[name]) {\n        this.el.setAttribute(name, '');\n      }\n    }\n  },\n\n  updateNavLocation: function () {\n    this.navGroup = null;\n    this.navNode = null;\n  },\n\n  /*******************************************************************\n   * Tick\n   */\n\n  tick: (function () {\n    const start = new THREE.Vector3();\n    const end = new THREE.Vector3();\n    const clampedEnd = new THREE.Vector3();\n\n    return function (t, dt) {\n      if (!dt) return;\n\n      const el = this.el;\n      const data = this.data;\n\n      if (!data.enabled) return;\n\n      this.updateVelocityCtrl();\n      const velocityCtrl = this.velocityCtrl;\n      const velocity = this.velocity;\n\n      if (!velocityCtrl) return;\n\n      // Update velocity. If FPS is too low, reset.\n      if (dt / 1000 > MAX_DELTA) {\n        velocity.set(0, 0, 0);\n      } else {\n        this.updateVelocity(dt);\n      }\n\n      if (data.constrainToNavMesh\n          && velocityCtrl.isNavMeshConstrained !== false) {\n\n        if (velocity.lengthSq() < EPS) return;\n\n        start.copy(el.object3D.position);\n        end\n          .copy(velocity)\n          .multiplyScalar(dt / 1000)\n          .add(start);\n\n        const nav = el.sceneEl.systems.nav;\n        this.navGroup = this.navGroup === null ? nav.getGroup(start) : this.navGroup;\n        this.navNode = this.navNode || nav.getNode(start, this.navGroup);\n        this.navNode = nav.clampStep(start, end, this.navGroup, this.navNode, clampedEnd);\n        el.object3D.position.copy(clampedEnd);\n      } else if (el.hasAttribute('velocity')) {\n        el.setAttribute('velocity', velocity);\n      } else {\n        el.object3D.position.x += velocity.x * dt / 1000;\n        el.object3D.position.y += velocity.y * dt / 1000;\n        el.object3D.position.z += velocity.z * dt / 1000;\n      }\n\n    };\n  }()),\n\n  /*******************************************************************\n   * Movement\n   */\n\n  updateVelocityCtrl: function () {\n    const data = this.data;\n    if (data.enabled) {\n      for (let i = 0, l = data.controls.length; i < l; i++) {\n        const control = this.el.components[data.controls[i] + COMPONENT_SUFFIX];\n        if (control && control.isVelocityActive()) {\n          this.velocityCtrl = control;\n          return;\n        }\n      }\n      this.velocityCtrl = null;\n    }\n  },\n\n  updateVelocity: (function () {\n    const vector2 = new THREE.Vector2();\n    const quaternion = new THREE.Quaternion();\n\n    return function (dt) {\n      let dVelocity;\n      const el = this.el;\n      const control = this.velocityCtrl;\n      const velocity = this.velocity;\n      const data = this.data;\n\n      if (control) {\n        if (control.getVelocityDelta) {\n          dVelocity = control.getVelocityDelta(dt);\n        } else if (control.getVelocity) {\n          velocity.copy(control.getVelocity());\n          return;\n        } else if (control.getPositionDelta) {\n          velocity.copy(control.getPositionDelta(dt).multiplyScalar(1000 / dt));\n          return;\n        } else {\n          throw new Error('Incompatible movement controls: ', control);\n        }\n      }\n\n      if (el.hasAttribute('velocity') && !data.constrainToNavMesh) {\n        velocity.copy(this.el.getAttribute('velocity'));\n      }\n\n      if (dVelocity && data.enabled) {\n        const cameraEl = data.camera;\n\n        // Rotate to heading\n        quaternion.copy(cameraEl.object3D.quaternion);\n        quaternion.premultiply(el.object3D.quaternion);\n        dVelocity.applyQuaternion(quaternion);\n\n        const factor = dVelocity.length();\n        if (data.fly) {\n          velocity.copy(dVelocity);\n          velocity.multiplyScalar(this.data.speed * 16.66667);\n        } else {\n          vector2.set(dVelocity.x, dVelocity.z);\n          vector2.setLength(factor * this.data.speed * 16.66667);\n          velocity.x = vector2.x;\n          velocity.z = vector2.y;\n        }\n      }\n    };\n\n  }())\n});\n\n};"],
"names":["shadow$provide","global","require","module","exports","AFRAME","registerComponent","dependencies","schema","enabled","default","controls","speed","min","fly","constrainToNavMesh","camera","type","init","el","velocityCtrl","velocity","THREE","Vector3","heading","Quaternion","navNode","navGroup","sceneEl","hasLoaded","injectControls","addEventListener","bind","update","prevData","data","nav","systems","addAgent","removeAgent","name","i","length","COMPONENT_SUFFIX","components","setAttribute","updateNavLocation","tick","start","end","clampedEnd","t","dt","updateVelocityCtrl","MAX_DELTA","set","updateVelocity","isNavMeshConstrained","EPS","lengthSq","copy","object3D","position","multiplyScalar","add","getGroup","getNode","clampStep","hasAttribute","x","y","z","l","control","isVelocityActive","vector2","Vector2","quaternion","getVelocityDelta","dVelocity","getVelocity","getPositionDelta","Error","getAttribute","premultiply","applyQuaternion","factor","setLength"]
}
